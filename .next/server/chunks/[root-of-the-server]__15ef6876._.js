module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},63955,e=>{"use strict";let t=new Map,r=(e,t)=>`velocity:ip:${e}:${t}m`,i=(e,t)=>`velocity:card:${e}:${t}m`,s=(e,t)=>`velocity:email:${e}:${t}m`,a=(e,t)=>`velocity:device:${e}:${t}m`;async function n(e){try{let n=Date.now();for(let o of[5,15,60]){if(e.ip){let i=r(e.ip,o);t.has(i)||t.set(i,[]),t.get(i).push({score:n,member:`${n}:${e.amount}`})}if(e.cardBin){let r=i(e.cardBin,o);t.has(r)||t.set(r,[]),t.get(r).push({score:n,member:`${n}:${e.amount}`})}if(e.email){let r=s(e.email.toLowerCase(),o);t.has(r)||t.set(r,[]),t.get(r).push({score:n,member:`${n}:${e.amount}`})}if(e.deviceFingerprint){let r=a(e.deviceFingerprint,o);t.has(r)||t.set(r,[]),t.get(r).push({score:n,member:`${n}:${e.amount}`})}}let o=n-36e5;t.forEach((e,r)=>{let i=e.filter(e=>e.score>=o);0===i.length?t.delete(r):t.set(r,i)})}catch(e){console.warn("Velocity tracking error (non-critical):",e)}}async function o(e){let n=Date.now(),o={ip_5m:0,ip_15m:0,card_5m:0,card_15m:0,email_5m:0,email_15m:0,device_5m:0,device_15m:0};try{let c=(e,r)=>{let i=t.get(e)||[],s=n-r;return i.filter(e=>e.score>=s).length};e.ip&&(o.ip_5m=c(r(e.ip,5),3e5),o.ip_15m=c(r(e.ip,15),9e5)),e.cardBin&&(o.card_5m=c(i(e.cardBin,5),3e5),o.card_15m=c(i(e.cardBin,15),9e5)),e.email&&(o.email_5m=c(s(e.email.toLowerCase(),5),3e5),o.email_15m=c(s(e.email.toLowerCase(),15),9e5)),e.deviceFingerprint&&(o.device_5m=c(a(e.deviceFingerprint,5),3e5),o.device_15m=c(a(e.deviceFingerprint,15),9e5))}catch(e){console.warn("Velocity count error (non-critical):",e)}return o}e.s(["getVelocityCounts",()=>o,"trackTransaction",()=>n])},75375,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),s=e.i(59756),a=e.i(61916),n=e.i(14444),o=e.i(37092),c=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),m=e.i(66012),h=e.i(70101),_=e.i(26937),f=e.i(10372),v=e.i(93695);e.i(52474);var g=e.i(5232),w=e.i(89171),y=e.i(63955);let x=new Set(["400000","411111","555555"]),R=new Set(["NG","RU","CN","VN","PH","ID"]),k=new Set(["tempmail.com","guerrillamail.com","10minutemail.com","mailinator.com","throwaway.email","temp-mail.org","fakeinbox.com"]);async function b(e,t={merchantRiskTolerance:50}){let r,i=performance.now(),s=[],a=0;if(t.whitelistedEmails?.has(e.customer_email?.toLowerCase()||""))return{transaction_id:e.transaction_id||crypto.randomUUID(),risk_score:0,decision:"approve",risk_factors:[{factor:"whitelist",score:0,description:"Email is whitelisted",severity:"low"}],processing_time_ms:Math.round(performance.now()-i)};if(t.whitelistedIPs?.has(e.customer_ip||""))return{transaction_id:e.transaction_id||crypto.randomUUID(),risk_score:0,decision:"approve",risk_factors:[{factor:"whitelist",score:0,description:"IP is whitelisted",severity:"low"}],processing_time_ms:Math.round(performance.now()-i)};if(t.blacklistedEmails?.has(e.customer_email?.toLowerCase()||""))return{transaction_id:e.transaction_id||crypto.randomUUID(),risk_score:100,decision:"decline",risk_factors:[{factor:"blacklist",score:100,description:"Email is blacklisted",severity:"high"}],processing_time_ms:Math.round(performance.now()-i)};if(t.blacklistedIPs?.has(e.customer_ip||""))return{transaction_id:e.transaction_id||crypto.randomUUID(),risk_score:100,decision:"decline",risk_factors:[{factor:"blacklist",score:100,description:"IP is blacklisted",severity:"high"}],processing_time_ms:Math.round(performance.now()-i)};let n=await (0,y.getVelocityCounts)({ip:e.customer_ip,cardBin:e.card_bin,email:e.customer_email,deviceFingerprint:e.device_fingerprint});if(n.ip_5m>3){let e={factor:"ip_velocity",score:Math.min(10*n.ip_5m,40),description:`${n.ip_5m} transactions from this IP in last 5 minutes`,severity:n.ip_5m>5?"high":"medium"};s.push(e),a+=e.score}if(n.card_5m>2){let e={factor:"card_velocity",score:Math.min(15*n.card_5m,45),description:`${n.card_5m} transactions with this card in last 5 minutes`,severity:n.card_5m>4?"high":"medium"};s.push(e),a+=e.score}if(n.email_15m>3){let e={factor:"email_velocity",score:Math.min(8*n.email_15m,30),description:`${n.email_15m} transactions with this email in last 15 minutes`,severity:"medium"};s.push(e),a+=e.score}if(e.amount_cents>5e4){let t={factor:"high_amount",score:e.amount_cents>1e5?20:10,description:`High transaction amount: $${(e.amount_cents/100).toFixed(2)}`,severity:e.amount_cents>1e5?"medium":"low"};s.push(t),a+=t.score}if(e.amount_cents%1e4==0&&e.amount_cents>1e4){let e={factor:"round_amount",score:10,description:"Suspiciously round transaction amount",severity:"low"};s.push(e),a+=e.score}if(e.card_bin&&x.has(e.card_bin)){let e={factor:"high_risk_bin",score:25,description:"Card BIN associated with higher fraud rates",severity:"medium"};s.push(e),a+=e.score}if(e.customer_country&&R.has(e.customer_country)){let t={factor:"high_risk_country",score:30,description:`Transaction from high-risk country: ${e.customer_country}`,severity:"high"};s.push(t),a+=t.score}if(e.customer_email){let t=e.customer_email.split("@")[1]?.toLowerCase();if(t&&k.has(t)){let e={factor:"disposable_email",score:35,description:"Using disposable email service",severity:"high"};s.push(e),a+=e.score}let r=e.customer_email.split("@")[0];if(/^\d+$/.test(r)||/^[a-z]\d{5,}$/i.test(r)){let e={factor:"suspicious_email",score:15,description:"Email pattern suggests auto-generation",severity:"medium"};s.push(e),a+=e.score}}if(!e.customer_ip){let e={factor:"missing_ip",score:10,description:"Customer IP address not provided",severity:"low"};s.push(e),a+=e.score}if(!e.device_fingerprint){let e={factor:"missing_device",score:5,description:"Device fingerprint not provided",severity:"low"};s.push(e),a+=e.score}a=Math.min(a,100);let o=Math.max(20,.4*t.merchantRiskTolerance),c=Math.max(50,.8*t.merchantRiskTolerance);return r=a<=o?"approve":a<=c?"review":"decline",await (0,y.trackTransaction)({ip:e.customer_ip,cardBin:e.card_bin,email:e.customer_email,deviceFingerprint:e.device_fingerprint,amount:e.amount_cents}),{transaction_id:e.transaction_id||crypto.randomUUID(),risk_score:a,decision:r,risk_factors:s.sort((e,t)=>t.score-e.score),processing_time_ms:Math.round(performance.now()-i)}}let E=new Map;async function C(e){let t=performance.now();try{let r,i,s=e.headers.get("x-api-key");if(!s)return w.NextResponse.json({error:"Missing API key. Include x-api-key header."},{status:401});if(r=Date.now(),(i=E.get(s))&&!(r>i.resetTime)?i.count>=100||(i.count++,!1):(E.set(s,{count:1,resetTime:r+6e4}),!1))return w.NextResponse.json({error:"Rate limit exceeded. Max 100 requests per minute."},{status:429});if(!(s.startsWith("pg_")||"demo_key"===s))return w.NextResponse.json({error:"Invalid API key format. Use pg_* keys."},{status:401});let a=await e.json();if("number"!=typeof a.amount_cents||a.amount_cents<=0)return w.NextResponse.json({error:"amount_cents is required and must be a positive number"},{status:400});let n=await b(a,{merchantRiskTolerance:50,whitelistedEmails:new Set,whitelistedIPs:new Set,blacklistedEmails:new Set,blacklistedIPs:new Set}),o=Math.round(performance.now()-t);return w.NextResponse.json({...n,processing_time_ms:o},{headers:{"X-Processing-Time":`${o}ms`}})}catch(e){return console.error("Risk scoring error:",e),w.NextResponse.json({error:"Internal server error"},{status:500})}}async function P(){return w.NextResponse.json({status:"ok",service:"PayGuard AI Risk Scoring API",version:"1.0.0"})}e.s(["GET",()=>P,"POST",()=>C],66632);var I=e.i(66632);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/score/route",pathname:"/api/score",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/score/route.ts",nextConfigOutput:"",userland:I}),{workAsyncStorage:N,workUnitAsyncStorage:$,serverHooks:A}=T;function M(){return(0,i.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:$})}async function S(e,t,i){T.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/score/route";w=w.replace(/\/index$/,"")||"/";let y=await T.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:x,params:R,nextConfig:k,parsedUrl:b,isDraftMode:E,prerenderManifest:C,routerServerContext:P,isOnDemandRevalidate:I,revalidateOnlyGenerated:N,resolvedPathname:$,clientReferenceManifest:A,serverActionsManifest:M}=y,S=(0,c.normalizeAppPath)(w),U=!!(C.dynamicRoutes[S]||C.routes[$]),j=async()=>((null==P?void 0:P.render404)?await P.render404(e,t,b,!1):t.end("This page could not be found"),null);if(U&&!E){let e=!!C.routes[$],t=C.dynamicRoutes[S];if(t&&!1===t.fallback&&!e){if(k.experimental.adapterPath)return await j();throw new v.NoFallbackError}}let D=null;!U||T.isDev||E||(D="/index"===(D=$)?"/":D);let O=!0===T.isDev||!U,q=U&&!O;M&&A&&(0,n.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:A,serverActionsManifest:M,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:M})});let H=e.method||"GET",F=(0,a.getTracer)(),B=F.getActiveScopeSpan(),L={params:R,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!k.experimental.authInterrupts},cacheComponents:!!k.cacheComponents,supportsDynamicResponse:O,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:k.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>T.onRequestError(e,t,i,P)},sharedContext:{buildId:x}},K=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let n=async e=>T.handle(G,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${w}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),c=async s=>{var a,c;let l=async({previousCacheEntry:r})=>{try{if(!o&&I&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=L.renderOpts.fetchMetrics;let c=L.renderOpts.pendingWaitUntil;c&&i.waitUntil&&(i.waitUntil(c),c=void 0);let l=L.renderOpts.collectedTags;if(!U)return await (0,m.sendResponse)(K,V,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[f.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,i=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:I})},P),t}},d=await T.handleResponse({req:e,nextConfig:k,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:N,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:o});if(!U)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",I?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&U||u.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,_.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(K,V,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};B?await c(B):await F.withPropagatedContext(e.headers,()=>F.trace(u.BaseServerSpan.handleRequest,{spanName:`${H} ${w}`,kind:a.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},c))}catch(t){if(t instanceof v.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:I})}),U)throw t;return await (0,m.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>M,"routeModule",()=>T,"serverHooks",()=>A,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>$],75375)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__15ef6876._.js.map